#!/usr/bin/env python
"""
Convert the d20 SRD SQLite database
"""

import sys, os

from twisted.python import usage

from playtools import convert


def getConverterSubcommands():
    """Return the 4-tuples of subcommands for all converters"""
    ret = []
    for c in convert.getConverters():
        ret.append((c.label(), None, c.commandLine, convert.converterDoc(c)))
    return ret

        
class Options(usage.Options):
    synopsis = """ptconvert <converter> [<converter args>]""" 
    subCommands = getConverterSubcommands()
    optParameters = [['n3file', None, None, "Filename to write n3 data"],
                     ['xmlfile', None, None, "Filename to write xml data"],
        ]

    def postOptions(self):
        c = convert.getConverter(self.subCommand)
        n3f = open(self['n3file'], 'w')
        xmlf = open(self['xmlfile'], 'w')
        io = convert.PlaytoolsIO(n3f, xmlf)
        c.n3Preamble(io)
        for item in c:
            c.writePlaytoolsItem(io, item)
        

def run(argv=None):
    if argv is None:
        argv = sys.argv
    o = Options()
    try:
        o.parseOptions(argv[1:])
    except usage.UsageError, e:
        print str(o)
        print str(e)
        return 1

    return 0


if __name__ == '__main__': sys.exit(run())

