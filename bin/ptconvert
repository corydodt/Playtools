#!/usr/bin/env python
"""
Convert the d20 SRD SQLite database
"""

import sys, os

from twisted.python import usage

from playtools import convert


def getConverterSubcommands():
    """Return the 4-tuples of subcommands for all converters"""
    ret = []
    for c in convert.getConverters():
        ret.append((c.label(), None, c.commandLine, convert.converterDoc(c)))
    return ret
        
class Options(usage.Options):
    synopsis = """ptconvert <converter> [<converter args>]""" 
    subCommands = getConverterSubcommands()

    def parseArgs(self, converter=None):
        self['converter'] = convert.getConverter(converter)

    def postOptions(self):
        c = self['converter']
        c.n3Preamble(sys.stdout)
        for item in c:
            c.writePlaytoolsItem(sys.stdout, item)
        

def run(argv=None):
    if argv is None:
        argv = sys.argv
    o = Options()
    try:
        o.parseOptions(argv[1:])
    except usage.UsageError, e:
        print str(o)
        print str(e)
        return 1

    return 0


if __name__ == '__main__': sys.exit(run())

